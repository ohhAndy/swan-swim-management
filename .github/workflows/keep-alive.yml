name: Keep Alive

on:
  schedule:
    # Weekdays (Mon-Fri) 3 PM - 9 PM Eastern Time
    # Covers both EST (UTC-5) and EDT (UTC-4).
    # 3 PM EST = 20:00 UTC | 3 PM EDT = 19:00 UTC
    # 9 PM EST = 02:00 UTC | 9 PM EDT = 01:00 UTC
    # Expanded Range: 19:00 - 23:00 (Day N) AND 00:00 - 02:00 (Day N+1)
    - cron: "*/10 19-23 * * 1-5"
    - cron: "*/10 0-2 * * 2-6"

    # Weekends (Sat-Sun) 9 AM - 6 PM Eastern Time
    # 9 AM EST = 14:00 UTC | 9 AM EDT = 13:00 UTC
    # 6 PM EST = 23:00 UTC | 6 PM EDT = 22:00 UTC
    # Expanded Range: 13:00 - 23:00 UTC
    - cron: "*/10 13-23 * * 6,0"
  workflow_dispatch:

jobs:
  keep_alive:
    name: Ping Health Endpoint
    runs-on: ubuntu-latest
    steps:
      - name: Ping Health Endpoint
        run: |
          # Use secret BACKEND_URL if set, otherwise default to user provided or placeholder.
          # Here we assume the user will set the secret.
          URL="${{ secrets.BACKEND_URL }}/health"
          if [ -z "${{ secrets.BACKEND_URL }}" ]; then
            echo "BACKEND_URL secret is not set. Please set it in repository secrets."
            exit 1
          fi

          echo "Pinging $URL"
          response=$(curl -s -o /dev/null -w "%{http_code}" "$URL")

          if [ "$response" -eq 200 ]; then
            echo "Health check passed: $response"
          else
            echo "Health check failed: $response"
            exit 1
          fi
